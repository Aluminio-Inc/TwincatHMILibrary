<?xml version="1.0" encoding="utf-8"?>
<TcPlcObject Version="1.1.0.1">
  <POU Name="FB_MotionDevices" Id="{6561488d-5d31-48fa-9698-23146b5d0312}" SpecialFunc="None">
    <Declaration><![CDATA[FUNCTION_BLOCK FB_MotionDevices EXTENDS FB_HMIBase
VAR
	motion : Motion.I_WebDrive;  // Using interface for polymorphism
	motionStatus : ST_HMIWebDriveStatus;
END_VAR
]]></Declaration>
    <Implementation>
      <ST><![CDATA[]]></ST>
    </Implementation>
    <Method Name="Cyclic" Id="{b41161a6-18ca-4275-b0ae-52d268e55440}">
      <Declaration><![CDATA[METHOD Cyclic
VAR
END_VAR
]]></Declaration>
      <Implementation>
        <ST><![CDATA[// Sync status from WebDrive to HMI
IF __ISVALIDREF(motion.P_BaseStatus) THEN
	motionStatus.HmiStatus.Busy := motion.P_BaseStatus.Busy;
	motionStatus.HmiStatus.Done := motion.P_BaseStatus.Done;
	motionStatus.HmiStatus.Error := motion.P_BaseStatus.Error;
	motionStatus.HmiStatus.ErrorID := UDINT_TO_BYTE(motion.P_BaseStatus.ErrorID);
END_IF

// Map WebDrive-specific status
motionStatus.Calibrated := motion.P_Calibrated;
motionStatus.DriveState := motion.P_DriveState;
motionStatus.TensionerRadius := motion.P_TensionerRadius;
motionStatus.TensionerTension := motion.P_TensionerTension;
motionStatus.WinderRadius := motion.P_WinderRadius;

// Handle commands from base class
IF cmd.Enable THEN
	motion.PowerOn();
	cmd.Enable := FALSE;
END_IF

IF cmd.Disable THEN
	motion.PowerOff();
	cmd.Disable := FALSE;
END_IF]]></ST>
      </Implementation>
    </Method>
    <Method Name="FB_init" Id="{e266e6fc-c9f6-411e-9941-87a945869314}">
      <Declaration><![CDATA[METHOD FB_init : BOOL
VAR_INPUT
	bInitRetains : BOOL; // if TRUE, the retain variables are initialized (warm start / cold start)
	bInCopyCode : BOOL;  // if TRUE, the instance afterwards gets moved into the copy code (online change)
END_VAR
]]></Declaration>
      <Implementation>
        <ST><![CDATA[// Standard FB constructor - no custom initialization needed]]></ST>
      </Implementation>
    </Method>
    <Method Name="Init" Id="{e266e6fd-c9f6-411e-9941-87a945869314}">
      <Declaration><![CDATA[METHOD Init : BOOL
VAR_INPUT
	refMotion : Motion.I_WebDrive;
END_VAR
]]></Declaration>
      <Implementation>
        <ST><![CDATA[motion := refMotion;
Init := TRUE;]]></ST>
      </Implementation>
    </Method>
    <Method Name="Calibrate" Id="{a1b2c3d4-e5f6-7890-1234-567890abcdef}">
      <Declaration><![CDATA[METHOD Calibrate : BOOL
VAR_INPUT
END_VAR
]]></Declaration>
      <Implementation>
        <ST><![CDATA[Calibrate := motion.Calibrate();
]]></ST>
      </Implementation>
    </Method>
    <Method Name="Scroll" Id="{b2c3d4e5-f6a7-8901-2345-67890abcdef1}">
      <Declaration><![CDATA[METHOD Scroll : BOOL
VAR_INPUT
	scrollDistance : LREAL;
END_VAR
]]></Declaration>
      <Implementation>
        <ST><![CDATA[Scroll := motion.Scroll(scrollDistance);
]]></ST>
      </Implementation>
    </Method>
    <Method Name="SetTension" Id="{c3d4e5f6-a7b8-9012-3456-7890abcdef12}">
      <Declaration><![CDATA[METHOD SetTension : BOOL
VAR_INPUT
	tensionValue : LREAL;
END_VAR
]]></Declaration>
      <Implementation>
        <ST><![CDATA[SetTension := motion.SetTension(tensionValue);
]]></ST>
      </Implementation>
    </Method>
    <Method Name="Stop" Id="{d4e5f6a7-b8c9-0123-4567-890abcdef123}">
      <Declaration><![CDATA[METHOD Stop : Base.E_CommandResult
VAR_INPUT
END_VAR
]]></Declaration>
      <Implementation>
        <ST><![CDATA[Stop := motion.Stop();
]]></ST>
      </Implementation>
    </Method>
    <Method Name="Halt" Id="{e5f6a7b8-c9d0-1234-5678-90abcdef1234}">
      <Declaration><![CDATA[METHOD Halt : Motion.E_CommandResult
VAR_INPUT
END_VAR
]]></Declaration>
      <Implementation>
        <ST><![CDATA[Halt := motion.Halt();
]]></ST>
      </Implementation>
    </Method>
    <Method Name="ResetAxes" Id="{f6a7b8c9-d0e1-2345-6789-0abcdef12345}">
      <Declaration><![CDATA[METHOD ResetAxes : Base.E_CommandResult
VAR_INPUT
END_VAR
]]></Declaration>
      <Implementation>
        <ST><![CDATA[ResetAxes := motion.ResetAxes();
]]></ST>
      </Implementation>
    </Method>
    <Property Name="P_MotionStatus" Id="{a7b8c9d0-e1f2-3456-7890-abcdef123456}">
      <Declaration><![CDATA[PROPERTY P_MotionStatus : ST_HMIWebDriveStatus]]></Declaration>
      <Get Name="Get" Id="{b8c9d0e1-f2a3-4567-8901-bcdef1234567}">
        <Declaration><![CDATA[VAR
END_VAR
]]></Declaration>
        <Implementation>
          <ST><![CDATA[P_MotionStatus := motionStatus;
]]></ST>
        </Implementation>
      </Get>
    </Property>
  </POU>
</TcPlcObject>